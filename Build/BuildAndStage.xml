<?xml version='1.0' ?>
<BuildGraph xmlns="http://www.epicgames.com/BuildGraph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.epicgames.com/BuildGraph ../Schema.xsd" >

	<Option Name="WorkspaceRoot" DefaultValue="" Description="The root directory for the workspace"/>
	<Option Name="ProjectName" DefaultValue="GunsmithExamples" Description="Name of the project"/>
	<Option Name="OutputRoot" DefaultValue="" Description="The root directory to stage the files"/>

	<Property Name="TargetProject" Value="$(WorkspaceRoot)/$(ProjectName).uproject" />
	<Property Name="BCRArgs" Value="-Project=&quot;$(TargetProject)&quot;" />
	<Property Name="StagedPlatformFolder" Value="PC" />

	<Agent Name="Properties Agent" Type="Compile">

	<!-- Build the Editor and all the necessary Tools first -->
		<Node Name="Compile" Produces="#Compiled_Binaries">
			<Compile Target="$(ProjectName)" Platform="Win64" Configuration="Development" Arguments="-Project=&quot;$(TargetProject)&quot;"/>
		</Node>

		<Node Name="Compile Tools" Produces="#ToolBinaries">
            <Compile Target="CrashReportClient" Platform="Win64" Configuration="Development" Tag="#ToolBinaries"/>
            <Compile Target="CrashReportClientEditor" Platform="Win64" Configuration="Development" Tag="#ToolBinaries"/>
			<Compile Target="ShaderCompileWorker" Platform="Win64" Configuration="Development" Tag="#ToolBinaries"/>
        </Node>

		<Node Name="Compile Editor" Requires="Compile Tools" Produces="#EditorBinaries">
            <Compile Target="$(ProjectName)Editor" Platform="Win64" Configuration="Development" Tag="#EditorBinaries" Arguments="-Project=&quot;$(TargetProject)&quot;"/>
        </Node>

		<!-- Package the client -->
		<Node Name="CookClient" RunEarly="true">
            <Cook Project="$(TargetProject)" Platform="Windows" Arguments="-manifests"/>
        </Node>

		<Property Name="BCRArgsClient" Value="$(BCRArgs) -target=&quot;$(ProjectName)&quot; -platform=Win64" />

		<Node Name="StageClient" >
            <Command Name="BuildCookRun" Arguments="$(BCRArgsClient) -configuration=Shipping -skipbuild -skipcook -stage -pak -iostore -prereqs" />
        </Node>

        <Node Name="PackageClient" Requires="StageClient">
            <Command Name="BuildCookRun" Arguments="$(BCRArgsClient) -configuration=Shipping -skipbuild -skipcook -skipstage -skippak -package" />
        </Node>

	</Agent>

	<Aggregate Name="Build All Platforms" Requires="Compile;Compile Tools;Compile Editor;CookClient;StageClient;PackageClient"/>
</BuildGraph>
